<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Keuangan & Stok</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }
        .btn-reset {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); /* Gray color for reset */
            transition: all 0.3s ease;
        }
        .btn-reset:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(75, 85, 99, 0.4);
        }
        .summary-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-left: 4px solid;
        }
        .modal {
            backdrop-filter: blur(5px);
            background: rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .item-card {
            transition: all 0.3s ease;
        }
        .item-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        }
        .stock-low {
            border-left-color: #ef4444; /* red-500 */
        }
        .stock-medium {
            border-left-color: #f59e0b; /* amber-500 */
        }
        .stock-high {
            border-left-color: #10b981; /* emerald-500 */
        }
        .logo-icon {
            width: 24px;
            height: 24px;
        }
        .small-icon {
            width: 16px;
            height: 16px;
        }
        .medium-icon {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Header -->
    <header class="bg-white bg-opacity-10 backdrop-blur-md shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="text-2xl font-bold text-white flex items-center">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/be8d261c-576e-4e60-a1d2-2f1211304701.png" alt="Money management icon" class="logo-icon mr-3 rounded-lg">
                    Sistem Keuangan & Stok
                </h1>
                <div class="text-white text-sm" id="currentDate"></div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Dashboard Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="summary-card card rounded-lg p-6 border-l-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 font-medium">Total Modal</p>
                        <p class="text-2xl font-bold text-blue-600" id="totalModal">Rp 0</p>
                    </div>
                    <div class="p-3 bg-blue-100 rounded-full">
                         <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/5c639a52-63ae-426d-b86b-8ba046d08f94.png" alt="Wallet icon" class="small-icon">
                    </div>
                </div>
            </div>
            <div class="summary-card card rounded-lg p-6 border-l-red-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 font-medium">Total Pengeluaran</p>
                        <p class="text-2xl font-bold text-red-600" id="totalPengeluaran">Rp 0</p>
                    </div>
                    <div class="p-3 bg-red-100 rounded-full">
                        <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9a5805e2-bc03-406c-ad54-768a4c98b255.png" alt="Money outflow icon" class="small-icon">
                    </div>
                </div>
            </div>
            <div class="summary-card card rounded-lg p-6 border-l-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 font-medium">Total Omset</p>
                        <p class="text-2xl font-bold text-green-600" id="totalOmset">Rp 0</p>
                    </div>
                    <div class="p-3 bg-green-100 rounded-full">
                        <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/be550d2b-03f0-445e-9e95-2f576d59e6d3.png" alt="Sales revenue icon" class="small-icon">
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="card rounded-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Aksi Cepat</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                <button onclick="openModal('modalModal')" class="btn-primary text-white px-4 py-3 rounded-lg font-medium"> + Modal </button>
                <button onclick="openModal('pengeluaranModal')" class="btn-danger text-white px-4 py-3 rounded-lg font-medium"> - Pengeluaran </button>
                <button onclick="openModal('itemBaruModal')" class="btn-success text-white px-4 py-3 rounded-lg font-medium"> + Item Baru </button>
                <button onclick="openModal('tambahStokModal')" class="btn-warning text-white px-4 py-3 rounded-lg font-medium"> + Stok </button>
                <button onclick="openModal('penjualanModal')" class="btn-primary text-white px-4 py-3 rounded-lg font-medium"> Penjualan </button>
                <button onclick="openModal('resetConfirmModal')" class="btn-reset text-white px-4 py-3 rounded-lg font-medium"> Reset Data </button>
            </div>
        </div>

        <!-- Items & Stock -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="card rounded-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/72468a19-589d-4630-a011-8a078e071d2f.png" alt="Inventory box icon" class="medium-icon mr-2">
                    Stok Barang
                </h2>
                <div id="stockList" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- Placeholder will be replaced by JS -->
                </div>
            </div>

            <div class="card rounded-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                     <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/f3a9233c-6eae-4607-abec-93b3de4529ee.png" alt="Transaction history icon" class="medium-icon mr-2">
                    Riwayat Transaksi
                </h2>
                <div id="transactionHistory" class="space-y-2 max-h-96 overflow-y-auto">
                     <!-- Placeholder will be replaced by JS -->
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="card rounded-lg p-6 mt-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Statistik Penjualan</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <p class="text-2xl font-bold text-blue-600" id="totalItemTerjual">0</p>
                    <p class="text-sm text-gray-600">Total Item Terjual</p>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <p class="text-2xl font-bold text-green-600" id="totalJenisItem">0</p>
                    <p class="text-sm text-gray-600">Jenis Item</p>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-lg">
                    <p class="text-2xl font-bold text-purple-600" id="rataPenjualan">Rp 0</p>
                    <p class="text-sm text-gray-600">Rata-rata Penjualan</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white bg-opacity-10 backdrop-blur-md mt-16">
        <div class="container mx-auto px-4 py-6">
            <p class="text-center text-white text-sm">Â© 2025 Sistem Keuangan & Stok by Fajar</p>
        </div>
    </footer>

    <!-- Modals -->
    <!-- Modal for Adding Capital -->
    <div id="modalModal" class="modal fixed inset-0 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-4">Tambah Modal</h3>
            <form id="modalForm">
                <input type="number" id="inputModal" class="w-full px-3 py-2 border rounded-lg mb-2" placeholder="Jumlah Modal" required>
                <input type="text" id="keteranganModal" class="w-full px-3 py-2 border rounded-lg mb-4" placeholder="Keterangan (e.g., Modal awal)">
                <div class="flex justify-end space-x-3"><button type="button" onclick="closeModal('modalModal')" class="px-4 py-2 text-gray-600 border rounded-lg">Batal</button><button type="submit" class="btn-primary text-white px-4 py-2 rounded-lg">Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal for Expenses -->
    <div id="pengeluaranModal" class="modal fixed inset-0 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-4">Tambah Pengeluaran</h3>
            <form id="pengeluaranForm">
                <select id="kategoriPengeluaran" class="w-full px-3 py-2 border rounded-lg mb-2" required><option value="">Pilih Sumber Dana...</option><option value="modal">Dari Modal</option><option value="omset">Dari Omset</option></select>
                <input type="number" id="inputPengeluaran" class="w-full px-3 py-2 border rounded-lg mb-2" placeholder="Jumlah Pengeluaran" required>
                <input type="text" id="keteranganPengeluaran" class="w-full px-3 py-2 border rounded-lg mb-4" placeholder="Keterangan" required>
                <div id="saldoInfo" class="mb-4 p-3 bg-gray-50 rounded-lg hidden"><p class="text-sm">Saldo Tersedia: <span id="saldoTersedia" class="font-semibold"></span></p></div>
                <div class="flex justify-end space-x-3"><button type="button" onclick="closeModal('pengeluaranModal')" class="px-4 py-2 text-gray-600 border rounded-lg">Batal</button><button type="submit" class="btn-danger text-white px-4 py-2 rounded-lg">Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal for New Item -->
    <div id="itemBaruModal" class="modal fixed inset-0 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-4">Tambah Item Baru</h3>
            <form id="itemBaruForm">
                <input type="text" id="namaItem" class="w-full px-3 py-2 border rounded-lg mb-2" placeholder="Nama Item" required>
                <input type="number" id="hargaItem" class="w-full px-3 py-2 border rounded-lg mb-2" placeholder="Harga Jual" required>
                <input type="number" id="stokAwal" class="w-full px-3 py-2 border rounded-lg mb-4" placeholder="Stok Awal" required>
                <div class="flex justify-end space-x-3"><button type="button" onclick="closeModal('itemBaruModal')" class="px-4 py-2 text-gray-600 border rounded-lg">Batal</button><button type="submit" class="btn-success text-white px-4 py-2 rounded-lg">Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal for Adding Stock -->
    <div id="tambahStokModal" class="modal fixed inset-0 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-4">Tambah Stok</h3>
            <form id="tambahStokForm">
                <select id="pilihItemStok" class="w-full px-3 py-2 border rounded-lg mb-2" required><option value="">Pilih Item...</option></select>
                <input type="number" id="jumlahStokTambah" class="w-full px-3 py-2 border rounded-lg mb-4" placeholder="Jumlah Stok Tambahan" required>
                <div class="flex justify-end space-x-3"><button type="button" onclick="closeModal('tambahStokModal')" class="px-4 py-2 text-gray-600 border rounded-lg">Batal</button><button type="submit" class="btn-warning text-white px-4 py-2 rounded-lg">Tambah</button></div>
            </form>
        </div>
    </div>

    <!-- Modal for Sales -->
    <div id="penjualanModal" class="modal fixed inset-0 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-4">Input Penjualan</h3>
            <form id="penjualanForm">
                <select id="pilihItemJual" class="w-full px-3 py-2 border rounded-lg mb-2" required><option value="">Pilih Item...</option></select>
                <input type="number" id="jumlahTerjual" class="w-full px-3 py-2 border rounded-lg mb-4" placeholder="Jumlah Terjual" required>
                <div id="infoHarga" class="mb-4 p-3 bg-blue-50 rounded-lg hidden">
                    <p>Harga Satuan: <span id="hargaSatuan" class="font-semibold"></span></p>
                    <p>Stok Tersedia: <span id="stokTersedia" class="font-semibold"></span></p>
                    <p class="mt-2 text-lg">Total: <span id="totalHarga" class="font-bold"></span></p>
                </div>
                <div class="flex justify-end space-x-3"><button type="button" onclick="closeModal('penjualanModal')" class="px-4 py-2 text-gray-600 border rounded-lg">Batal</button><button type="submit" class="btn-primary text-white px-4 py-2 rounded-lg">Jual</button></div>
            </form>
        </div>
    </div>
    
    <!-- Modal for Reset Confirmation -->
    <div id="resetConfirmModal" class="modal fixed inset-0 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4" onclick="event.stopPropagation()">
            <h3 class="text-lg font-bold mb-2">Konfirmasi Reset Data</h3>
            <p class="text-gray-600 mb-6">Apakah Anda yakin ingin menghapus semua data? Aksi ini tidak dapat dibatalkan.</p>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeModal('resetConfirmModal')" class="px-4 py-2 text-gray-600 border rounded-lg">Batal</button>
                <button type="button" id="confirmResetBtn" class="btn-danger text-white px-4 py-2 rounded-lg">Ya, Reset</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // STATE MANAGEMENT
    let state = {
        modal: 0,
        pengeluaran: 0,
        omset: 0,
        items: [], // { id, name, price, stock }
        transactions: [], // { type, amount, desc, date }
    };

    // --- UTILITY FUNCTIONS ---
    const formatRupiah = (number) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
    const saveState = () => localStorage.setItem('keuanganStokState', JSON.stringify(state));
    const loadState = () => {
        const savedState = localStorage.getItem('keuanganStokState');
        if (savedState) {
            state = JSON.parse(savedState);
        }
    };

    // --- UI RENDERING ---
    const updateDashboard = () => {
        document.getElementById('totalModal').textContent = formatRupiah(state.modal);
        document.getElementById('totalPengeluaran').textContent = formatRupiah(state.pengeluaran);
        document.getElementById('totalOmset').textContent = formatRupiah(state.omset);
    };

    const renderStockList = () => {
        const stockListEl = document.getElementById('stockList');
        if (state.items.length === 0) {
            stockListEl.innerHTML = `<div class="text-gray-500 text-center py-8">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/c0eba984-059a-4c49-89f1-f7aeeee5578e.png" alt="Empty inventory illustration" class="mx-auto mb-4 w-24 h-24 opacity-50">
                Belum ada item. Tambahkan item baru.
            </div>`;
            return;
        }
        stockListEl.innerHTML = state.items.map(item => {
            const stockLevel = item.stock <= 5 ? 'low' : item.stock <= 20 ? 'medium' : 'high';
            return `<div class="item-card bg-white p-4 rounded-lg shadow-sm border-l-4 stock-${stockLevel}">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="font-bold text-gray-800">${item.name}</p>
                        <p class="text-sm text-gray-600">${formatRupiah(item.price)}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-bold text-gray-800">${item.stock}</p>
                        <p class="text-xs text-gray-500">Stok</p>
                    </div>
                </div>
            </div>`;
        }).join('');
    };
    
    const renderTransactionHistory = () => {
        const historyEl = document.getElementById('transactionHistory');
        if(state.transactions.length === 0) {
            historyEl.innerHTML = `<div class="text-gray-500 text-center py-8">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/257ff57e-31f8-4ccd-b8e3-d3207a3279a5.png" alt="Empty transaction history illustration" class="mx-auto mb-4 w-24 h-24 opacity-50">
                Belum ada transaksi.
            </div>`;
            return;
        }
        historyEl.innerHTML = [...state.transactions].reverse().map(trx => {
            const isCredit = ['modal', 'penjualan'].includes(trx.type);
            const color = isCredit ? 'green' : 'red';
            const sign = isCredit ? '+' : '-';
            return `<div class="flex justify-between items-center text-sm p-2 rounded-md hover:bg-gray-50">
                <div>
                    <p class="font-semibold text-gray-700">${trx.desc}</p>
                    <p class="text-xs text-gray-500">${trx.date}</p>
                </div>
                <p class="font-bold text-${color}-600">${sign} ${formatRupiah(trx.amount)}</p>
            </div>`;
        }).join('');
    };

    const updateItemDropdowns = () => {
        const options = state.items.map(item => `<option value="${item.id}">${item.name}</option>`).join('');
        const placeholder = `<option value="">Pilih Item...</option>`;
        document.getElementById('pilihItemStok').innerHTML = placeholder + options;
        document.getElementById('pilihItemJual').innerHTML = placeholder + options;
    };
    
    const updateStats = () => {
        const salesTransactions = state.transactions.filter(t => t.type === 'penjualan');
        const totalItemTerjual = salesTransactions.reduce((sum, t) => sum + (t.qty || 0), 0);
        const totalJenisItem = state.items.length;
        const totalOmset = state.omset;
        const rataPenjualan = salesTransactions.length > 0 ? totalOmset / salesTransactions.length : 0;

        document.getElementById('totalItemTerjual').textContent = totalItemTerjual;
        document.getElementById('totalJenisItem').textContent = totalJenisItem;
        document.getElementById('rataPenjualan').textContent = formatRupiah(rataPenjualan);
    };

    const updateUI = () => {
        updateDashboard();
        renderStockList();
        renderTransactionHistory();
        updateItemDropdowns();
        updateStats();
        saveState();
    };

    // --- MODAL HANDLING ---
    window.openModal = (modalId) => {
        document.getElementById(modalId).classList.remove('hidden');
        document.getElementById(modalId).classList.add('flex');
    };
    window.closeModal = (modalId) => {
        const modal = document.getElementById(modalId);
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        const form = modal.querySelector('form');
        if (form) form.reset();

        // Hide dynamic info divs
        ['saldoInfo', 'infoHarga'].forEach(id => {
            const el = document.getElementById(id);
            if(el) el.classList.add('hidden');
        });
    };
    // Close modal when clicking on the background
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', () => closeModal(modal.id));
    });

    // --- EVENT LISTENERS & HANDLERS ---
    const addTransaction = (type, amount, desc, details = {}) => {
        state.transactions.push({
            type,
            amount,
            desc,
            date: new Date().toLocaleString('id-ID'),
            ...details
        });
    };

    document.getElementById('modalForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const amount = parseInt(document.getElementById('inputModal').value);
        const desc = document.getElementById('keteranganModal').value || 'Tambah Modal';
        state.modal += amount;
        addTransaction('modal', amount, desc);
        closeModal('modalModal');
        updateUI();
    });

    document.getElementById('pengeluaranForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const category = document.getElementById('kategoriPengeluaran').value;
        const amount = parseInt(document.getElementById('inputPengeluaran').value);
        const desc = document.getElementById('keteranganPengeluaran').value;

        if ((category === 'modal' && amount > state.modal) || (category === 'omset' && amount > state.omset)) {
            alert('Saldo tidak mencukupi!');
            return;
        }

        if (category === 'modal') state.modal -= amount;
        if (category === 'omset') state.omset -= amount;
        
        state.pengeluaran += amount;
        addTransaction('pengeluaran', amount, desc);
        closeModal('pengeluaranModal');
        updateUI();
    });
    
    document.getElementById('itemBaruForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('namaItem').value;
        const price = parseInt(document.getElementById('hargaItem').value);
        const stock = parseInt(document.getElementById('stokAwal').value);
        state.items.push({ id: Date.now(), name, price, stock });
        addTransaction('item_baru', 0, `Item baru: ${name}`);
        closeModal('itemBaruModal');
        updateUI();
    });

    document.getElementById('tambahStokForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const itemId = parseInt(document.getElementById('pilihItemStok').value);
        const quantity = parseInt(document.getElementById('jumlahStokTambah').value);
        const item = state.items.find(i => i.id === itemId);
        if(item) {
            item.stock += quantity;
            addTransaction('tambah_stok', 0, `Tambah stok ${item.name} (+${quantity})`);
            closeModal('tambahStokModal');
            updateUI();
        }
    });

    document.getElementById('penjualanForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const itemId = parseInt(document.getElementById('pilihItemJual').value);
        const quantity = parseInt(document.getElementById('jumlahTerjual').value);
        const item = state.items.find(i => i.id === itemId);

        if(!item || quantity > item.stock) {
            alert('Stok tidak mencukupi!');
            return;
        }

        item.stock -= quantity;
        const total = item.price * quantity;
        state.omset += total;
        addTransaction('penjualan', total, `Jual ${item.name} (x${quantity})`, { qty: quantity });
        closeModal('penjualanModal');
        updateUI();
    });

    document.getElementById('confirmResetBtn').addEventListener('click', () => {
        localStorage.removeItem('keuanganStokState');
        state = { modal: 0, pengeluaran: 0, omset: 0, items: [], transactions: [] };
        closeModal('resetConfirmModal');
        updateUI();
    });
    
    // Dynamic info in modals
    document.getElementById('kategoriPengeluaran').addEventListener('change', (e) => {
        const category = e.target.value;
        const saldoInfo = document.getElementById('saldoInfo');
        const saldoTersedia = document.getElementById('saldoTersedia');
        if (category) {
            const balance = category === 'modal' ? state.modal : state.omset;
            saldoTersedia.textContent = formatRupiah(balance);
            saldoInfo.classList.remove('hidden');
        } else {
            saldoInfo.classList.add('hidden');
        }
    });

    const updatePenjualanInfo = () => {
        const itemId = parseInt(document.getElementById('pilihItemJual').value);
        const quantity = parseInt(document.getElementById('jumlahTerjual').value) || 0;
        const item = state.items.find(i => i.id === itemId);
        const infoHarga = document.getElementById('infoHarga');

        if(item) {
            document.getElementById('hargaSatuan').textContent = formatRupiah(item.price);
            document.getElementById('stokTersedia').textContent = item.stock;
            document.getElementById('totalHarga').textContent = formatRupiah(item.price * quantity);
            infoHarga.classList.remove('hidden');
        } else {
            infoHarga.classList.add('hidden');
        }
    };
    document.getElementById('pilihItemJual').addEventListener('change', updatePenjualanInfo);
    document.getElementById('jumlahTerjual').addEventListener('input', updatePenjualanInfo);

    // Set current date in header
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID', {
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });

    // --- INITIALIZATION ---
    loadState();
    updateUI();
});
</script>
</body>
</html>



